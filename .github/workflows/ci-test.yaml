name: Test
on:
  pull_request:
    types: [opened, synchronize]
  release:
    types: [prereleased]
  push:
    branches:
      - 'master'
env:
  API_TOKEN: ${{ secrets.API_TOKEN }}

jobs:
  Run_Tests:
    runs-on: macOS-12
    steps:
    - uses: actions/checkout@v3
    - name: Select Xcode
      run: sudo xcode-select -switch /Applications/Xcode_13.4.app && /usr/bin/xcodebuild -version

    - name: List Simulators
      run: xcrun simctl list runtimes

    - name: Swift test
      run: |
        set -eo pipefail
        swift build 
        swift test --parallel
        
    - name: Test iOS app
      run: exec ./.github/scripts/test_app.sh
